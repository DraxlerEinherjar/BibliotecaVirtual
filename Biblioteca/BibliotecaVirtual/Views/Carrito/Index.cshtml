@model IEnumerable<BibliotecaVirtual.Models.Libro>

@{
    ViewBag.Title = "Carrito";
    Layout = "~/Views/Shared/_Layout_two.cshtml";


}


<section id="team">
    <div class="container wow fadeInUp">
        <div class="row">
            <div class="col-md-12">
                <h3 class="section-title">Carrito</h3>
                <div class="section-title-divider"></div>
                @if (ViewBag.ids.Count == 0)
                {
                    <p class="section-description">Nada por aquí! ;)</p>
                }
            </div>
        </div>
        <div class="row">
            @if (ViewBag.ids != null)
            {
                foreach (var id in ViewBag.ids)
                {
                    var obj = Model.Where(w => w.IdLibro == id).FirstOrDefault() as BibliotecaVirtual.Models.Libro;
                    var cantidad = Model.Where(w => w.IdLibro == id).Count();
                    <div class="col-md-3">
                        <div class="member">
                            <div @*class="pic"*@><img src="@Url.Action("GetImage","Libro",new { id = obj.IdLibro})" alt="" class="new"></div>
                            <h4 style="height: 37px;"> @Html.DisplayFor(modelItem => obj.Nombre)</h4>
                            <span>@Html.DisplayFor(modelItem => obj.Autor.Nombre)</span>
                            <div class="social">
                                <strong>@String.Format("{0:c}", obj.PrecioUnitario)</strong>
                            </div>
                            <div class="social">
                                <button id="AddCart" onclick="AddCart(@obj.IdLibro)"><i class="fa fa-plus"></i></button>    |
                                <strong><label id="lbl_@obj.IdLibro">@cantidad</label></strong>  |
                                <button id="TakeOffCart" onclick="SubtractCart(@obj.IdLibro)"><i class="fa fa-minus"></i></button>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {

            }
        </div>
        <br />
        <br />
        <br />
    </div>
</section>

@section scripts{
    <script>
        var urlAgregarAlCarro = "@Url.Action("AgregarAlCarrito", "Home")";
        var urlQuitarAlCarrito = "@Url.Action("QuitarAlCarrito", "Home")";
        var urlElementosCarrito = "@Url.Action("ElementosCarrito", "Home")";
        $(document).ready(function () {
            ElementosCarrito();
        });

        function AddCart(e) {
            $.ajax({
                data: { "id": e },
                type: "POST",
                dataType: "json",
                url: urlAgregarAlCarro,
            })
                .done(function (data, textStatus, jqXHR) {
                    console.log(data);
                    if (console && console.log) {
                        ElementosCarrito();
                    }
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    console.log('mal');
                    if (console && console.log) {
                        console.log("La solicitud a fallado: " + textStatus);
                    }
                });
        }

        function SubtractCart(e) {
            $.ajax({
                data: { "id": e },
                type: "POST",
                dataType: "json",
                url: urlQuitarAlCarrito,
            })
                .done(function (data, textStatus, jqXHR) {
                    console.log(data);
                    if (console && console.log) {
                        ElementosCarrito();
                    }
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    console.log('mal');
                    if (console && console.log) {
                        console.log("La solicitud a fallado: " + textStatus);
                    }
                });
        }

        function ElementosCarrito() {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: urlElementosCarrito,
            })
                .done(function (data, textStatus, jqXHR) {
                    if (console && console.log) {
                        if (data != "nodata") {
                            $('#lblItems').text(data);
                            $('#carritoSpan').show();
                        } else {
                            $('#lblItems').text('0');
                            $('#carritoSpan').hide();
                        }
                    }
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    if (console && console.log) {
                        console.log("La solicitud a fallado: " + textStatus);
                    }
                });
        }


        function UpdateLabel(e) {

        }
    </script>
}

